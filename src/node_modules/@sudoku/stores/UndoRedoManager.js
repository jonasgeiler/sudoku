import { stateManager } from './stateManager';
import { userGrid } from './grid';

function createUndoRedoManager() {
    const undoList = [];    // 撤销
    const redoList = [];    // 重做

    return {
        newAction(index) {
            undoList.push(index);
            console.log(undoList);
            redoList.length = 0;
        },
        undo() {
            if(undoList.length > 1) {
                const oldIndex = undoList.pop();
                console.log(oldIndex);
                console.log(stateManager.get_state(undoList[undoList.length-1]));

                userGrid.setGrid(stateManager.get_state(undoList[undoList.length-1]));
                
                redoList.push(oldIndex);
            }
            else {
                console.log('Nothing to undo.');
            }
        },
        redo() {
            if(redoList.length > 0) {
                const oldIndex = redoList.pop();
                userGrid.setGrid(stateManager.get_state(oldIndex));
                undoList.push(oldIndex);
            }
            else {
                console.log('Nothing to redo.');
            }
        }
    }
}

export const UndoRedoManager = createUndoRedoManager();