import { cursor } from './stores/cursor';
import { difficulty } from './stores/difficulty';
import { gamePaused } from './stores/game';
import { grid } from './stores/grid';
import { timer } from './stores/timer';
import { hints } from './stores/hints';
import { stateManager } from './stores/stateManager'
import { UndoRedoManager } from './stores/UndoRedoManager';
import { decodeSencodeForGrid, decodeSencodeForCandidateGrid } from './sencode';
import { strategyService } from './stores/strategyService.js';
import { CandidateGrid } from '@sudoku/stores/candidateGrid.js';


/**
 * Start new game with a generated sudoku
 *
 * @param {('veryeasy' | 'easy' | 'medium' | 'hard')} diff - Difficulty
 */
export function startNew(diff) {
	difficulty.set(diff);
	strategyService.setInitCandidateGrid(new CandidateGrid());
	grid.generate(diff);
	cursor.reset();
	timer.reset();
	hints.reset();

	location.hash = '';

	stateManager.clear();
	stateManager.add_state(grid.get());
	UndoRedoManager.newAction(stateManager.get_index(grid.get()));
	// console.log('init input');
	// console.log(grid.get());
	// console.log(stateManager.get_state_dict());
}

/**
 * Start new game with a custom sudoku
 *
 * @param {string} sencode - Sencode to decode
 */
export function startCustom(sencode) {
	difficulty.setCustom();
	strategyService.setInitCandidateGrid(decodeSencodeForCandidateGrid(sencode));
	grid.decodeSencode(sencode);

	cursor.reset();
	timer.reset();
	hints.reset();

	stateManager.clear();
	stateManager.add_state(grid.get());
	UndoRedoManager.newAction(stateManager.get_index(grid.get()));
	// console.log('init input');
	// console.log(grid.get());
	// console.log(stateManager.get_state_dict());
}

/**
 * Pause the game
 */
export function pauseGame() {
	timer.stop();
	gamePaused.set(true);
}

/**
 * Resume (un-pause) the game
 */
export function resumeGame() {
	timer.start();
	gamePaused.set(false);
}

export default {
	startNew,
	startCustom,
	pause: pauseGame,
	resume: resumeGame
};